# Умные Ворота - Проект на ESP32 (Web Interface)

## Описание проекта

Проект "Умные Ворота" представляет собой систему автоматического управления воротами на базе ESP32 с веб-интерфейсом. Система позволяет управлять воротами через:

*   **433MHz пульты**: Прием сигналов от радиопультов
*   **GSM модуль**: Управление через SMS и звонки
*   **Веб-интерфейс**: Настройка через браузер (192.168.4.1)

## Компоненты

*   **ESP32 DevKit 38 pin**: Основной микроконтроллер с WiFi
*   **Радиомодуль SRX882 v1.3**: Приемник 433MHz
*   **Светодиод**: Для индикации импульса
*   **GSM модуль SIM800L**: Для приема звонков и SMS
*   **WiFi**: Встроенный модуль для веб-интерфейса

## Схема подключения

### Радиомодуль SRX882 v1.3
- **VCC** → 3.3V
- **GND** → GND  
- **DATA** → GPIO13

### Светодиод
- **Анод** → GPIO12 (через резистор 220Ω)
- **Катод** → GND

### GSM модуль SIM800L
- **VCC** → 5V (отдельный источник питания)
- **GND** → GND
- **TX** → GPIO21 (ESP32 RX)
- **RX** → GPIO16 (ESP32 TX)

## Веб-интерфейс

### Доступ к интерфейсу

1. **Подключитесь к WiFi**: `SmartGate-Config`
2. **Пароль**: `12345678`
3. **Откройте браузер**: `http://192.168.4.1`

### Функции интерфейса

#### Главная страница
- Статус WiFi подключения
- Количество настроенных телефонов
- Количество ключей 433MHz
- Управление воротами (открыть/закрыть)

#### WiFi настройка
- Сканирование доступных сетей
- Подключение к выбранной сети
- Ввод пароля

#### Управление телефонами
- Просмотр списка номеров
- Добавление новых номеров
- Настройка действий (SMS/Ring)
- Удаление номеров

#### Управление ключами 433MHz
- Просмотр списка ключей
- Обучение новых ключей
- Удаление ключей

## API Endpoints

### WiFi
- `GET /api/wifi/scan` - Сканирование сетей
- `POST /api/wifi/connect` - Подключение к сети

### Телефоны
- `GET /api/phones` - Список телефонов
- `POST /api/phones` - Добавить телефон
- `DELETE /api/phones/{index}` - Удалить телефон

### Ключи 433MHz
- `GET /api/keys` - Список ключей
- `POST /api/keys/learn` - Обучение ключа
- `DELETE /api/keys/{index}` - Удалить ключ

### Ворота
- `POST /api/gate/open` - Открыть ворота
- `POST /api/gate/close` - Закрыть ворота

## Установка и запуск

### Требования
- PlatformIO
- ESP32 DevKit 38 pin
- Компоненты согласно схеме

### Сборка и загрузка

```bash
# Клонирование репозитория
git clone <repository-url>
cd gates-radio

# Сборка проекта
pio run

# Загрузка на ESP32
pio run --target upload

# Мониторинг логов
pio device monitor
```

### Первый запуск

1. Подключите ESP32 к питанию
2. Подключитесь к WiFi `SmartGate-Config` (пароль: `12345678`)
3. Откройте браузер: `http://192.168.4.1`
4. Настройте WiFi подключение
5. Добавьте телефоны и ключи 433MHz

## Конфигурация

### Пины ESP32

```cpp
// Радиомодуль SRX882 v1.3
#define RF_DATA_PIN 13 // GPIO13 - Data pin

// Светодиод
#define LED_PIN     12 // GPIO12 - Управление светодиодом

// GSM SIM800L (UART2)
#define GSM_RX_PIN  21 // GPIO21 - RX пин для UART2
#define GSM_TX_PIN  16 // GPIO16 - TX пин для UART2
```

### WiFi настройки

- **Access Point SSID**: `SmartGate-Config`
- **Access Point Password**: `12345678`
- **IP Address**: `192.168.4.1`
- **Port**: `80`

## Библиотеки

```ini
lib_deps = 
    bblanchon/ArduinoJson@^7.0.4
    sui77/rc-switch@^2.6.4
    vshymanskyy/TinyGSM@^0.11.7
```

## Структура проекта

```
gates-radio/
├── src/
│   ├── main.cpp              # Основной код
│   ├── RF433Receiver.cpp     # Обработка 433MHz
│   ├── GateControl.cpp       # Управление воротами
│   └── GSMManager.cpp        # GSM модуль
├── include/
│   ├── RF433Receiver.h
│   ├── GateControl.h
│   └── GSMManager.h
├── platformio.ini            # Конфигурация PlatformIO
└── docs.md                   # Документация
```

## Отладка

### Мониторинг логов

```bash
pio device monitor --port /dev/cu.SLAB_USBtoUART --baud 115200
```

### Частые проблемы

1. **Не подключается к WiFi**: Проверьте пароль и сигнал
2. **Не работает веб-интерфейс**: Убедитесь что подключены к `SmartGate-Config`
3. **Не принимает 433MHz**: Проверьте подключение к GPIO13
4. **Не работает GSM**: Проверьте питание 5V и подключение UART

## Безопасность

- **Access Point**: Используйте сложный пароль в продакшене
- **WiFi**: Настройте подключение к защищенной сети
- **GSM**: Ограничьте номера телефонов в белом списке
- **433MHz**: Регулярно обновляйте список ключей

## Развитие проекта

### Планируемые функции
- [ ] Поддержка CAME протокола
- [ ] Интеграция с Алисой
- [ ] Мобильное приложение
- [ ] Логирование событий
- [ ] Уведомления по email

### Возможные улучшения
- [ ] OTA обновления
- [ ] Резервное питание
- [ ] Датчики безопасности
- [ ] Интеграция с умным домом

## Лицензия

MIT License

## Автор

Проект "Умные Ворота" - система управления воротами на ESP32